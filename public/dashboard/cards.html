<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonora</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/cards.css">
    <link rel="stylesheet" href="../css/loading.css">
    <link rel="shortcut icon" href="../assets/favicon.ico" type="image/x-icon">
</head>

<body>
    <div id="loading"></div>
    <header>
        <a href="../index.html"><img src="../assets/logo_sonora.svg" class="logo"></a>
        <nav>
            <ul>
                <li class="link-nav sec-atual"><a href="../index.html">Home</a>
                <li><a class="link-nav" href="cards.html">Line-ups</a>
                <li><a class="link-nav" href="perfil.html">Perfil</a>
                <li>
                    <button id="btn-login">Sair</button>
            </ul>
        </nav>
    </header>

    <main>
        <h1 id="nome">Bem vindo(a), <span id="span_nome_usuario"></span></h1>
        <section id="section-cards" class="section-cards">
            <div class="card-adicionar" onclick="location.href='lineups.html'">+</div>
        </section>

    </main>

    <footer>
        <section>
            <img src="../assets/logo_sonora.svg" class="logo">

            <address>
                <strong>Sonora</strong><br>
                Haddock Lobo, 595 - Cerqueira César<br>
                São Paulo, SP - Brasil
            </address>

            <div>
                <img src="../assets/icon/redes/instagram.svg" class="icone-rede">
                <img src="../assets/icon/redes/facebook.svg" class="icone-rede">
                <img src="../assets/icon/redes/whatsapp.svg" class="icone-rede">
            </div>

            <small>© 2025 Sonora. Todos o direitos reservados.</small>
        </section>

        <aside>
            <h4>Newsletters</h4>
            <p>Fique por dentro das últimas novidades da música</p>

            <div>
                <input placeholder="seu@email.com">

                <button>
                    Inscreva-se
                </button>
            </div>

            <small>Ao se inscrever, você concorda em receber nossos e-mails e está de acordo com os nossos Termos e
                Condições.</small>
        </aside>
    </footer>
    <script src="../js/sessao.js"></script>
    <script>
        span_nome_usuario.innerText = sessionStorage.NOME_USUARIO;

        document.querySelector("#btn-login").addEventListener("click", e => {
            sessionStorage.clear();
            location = "../index.html";
        });

        async function carregarLineups() {
            const idUsuario = sessionStorage.ID_USUARIO;
            if (!idUsuario) {
                console.error("ID de usuário não encontrado na sessionStorage");
                return;
            }

            try {
                const resposta = await fetch(`/artista/lineups/${idUsuario}`);
                if (!resposta.ok) throw new Error("Erro ao buscar line-ups");

                const lineups = await resposta.json();
                const secao = document.getElementById("section-cards");

                // Insere os cards antes do botão de adicionar
                const btnAdicionar = document.querySelector(".card-adicionar");

                lineups.forEach(lineup => {
                    const a = document.createElement("a");
                    a.href = `lineups.html`;
                    a.classList.add("card-link");

                    const div = document.createElement("div");
                    div.classList.add("card");
                    div.textContent = lineup.nomeLineup;

                    div.addEventListener("click", () => {
                        sessionStorage.setItem("ID_LINEUP_ATUAL", lineup.idLineup);
                        sessionStorage.setItem("NOME_LINEUP_ATUAL", lineup.nomeLineup);
                    });

                    a.appendChild(div);
                    secao.insertBefore(a, btnAdicionar);
                });


            } catch (erro) {
                console.error("Erro ao carregar line-ups:", erro);
            }
        }

        document.addEventListener("DOMContentLoaded", carregarLineups);
    </script>

</body>

</html>